#textdomain wesnoth-AD

[scenario]
    id=05_Discipline
    name= _ "Discipline"
    map_data="{~add-ons/Ashevieres_Dogs/maps/05_Discipline.map}"

    [event]
        name=prestart 

        {PLACE_IMAGE scenery/well.png 24 14}
        {PLACE_IMAGE scenery/tent-shop-weapons.png 22 18}
        {PLACE_IMAGE items/straw-bale1.png 17 15}
        {PLACE_IMAGE items/straw-bale2.png 18 13}
    [/event]

    turns=10
    next_scenario=06_The_Art_of_War
    victory_when_enemies_defeated=no
    carryover_percentage=40
    carryover_add=yes
    current_time=5

    {DEFAULT_SCHEDULE}

    {SCENARIO_MUSIC the_city_falls.ogg}
    {EXTRA_SCENARIO_MUSIC loyalists.ogg}
    {EXTRA_SCENARIO_MUSIC suspence.ogg}
    {EXTRA_SCENARIO_MUSIC the_king_is_dead.ogg}

    {AD_TRACK {JOURNEY_05_NEW} }

    [label]
        x,y=21,16
        text= _ "Tath"
        immutable=yes
    [/label]

    {STARTING_VILLAGES 1 4}

    [event]
        name=prestart 

        [capture_village]
            side=4
            y=6-31
        [/capture_village]
    [/event]

    {STARTING_VILLAGES 2 5}
    {STARTING_VILLAGES 3 5}

    [side]
        side=1
        controller=human
        gold=125
        {INCOME 5 3 1}
        fog=no
        shroud=no
        share_vision=all
        {BAZUR_ARC_I}
        color=red
        team_name=bazur
        user_team_name= _ "Asheviere’s Forces"
        save_id=bazur
        {FLAG_VARIANT ragged}

        [unit]
            {ISOLDE}
            placement=map,leader
        [/unit]
    [/side]

    [side]
        side=2
        controller=ai
        {GOLD 150 200 250}
        {INCOME 6 9 12}
        fog=no
        shroud=no
        share_vision=all
        type=Orcish Warlord
        id=Warlord_South
        recruit=Orcish Grunt,Troll Whelp,Troll,Troll Rocklobber,Troll Warrior,Orcish Archer
        team_name=bazur,evil_orcs
        user_team_name= _ "Asheviere’s Forces"
        color=blue
        {FLAG_VARIANT ragged}
        [ai]
            {NO_SCOUTS}
            recruitment_pattern=fighter,fighter,fighter,archer

            [goal]
                name=target_location 
                [criteria]
                    x,y=24,16 
                [/criteria]
                value={ON_DIFFICULTY "1.25" 2 3}
            [/goal]
        [/ai]
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Orcish Grunt" {ON_DIFFICULTY 4 3 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Orcish Archer" {ON_DIFFICULTY 4 3 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Troll Warrior" {ON_DIFFICULTY 1 2 3}}

    [side]
        side=3
        controller=ai
        {GOLD 150 200 250}
        {INCOME 6 9 12}
        fog=no
        shroud=no
        share_vision=all
        type=Orcish Warlord
        id=Warlord_West
        recruit=Orcish Archer,Orcish Crossbowman,Goblin Pillager,Goblin Knight,Wolf Rider,Orcish Grunt
        color=green
        team_name=bazur,evil_orcs
        user_team_name= _ "Asheviere’s Forces"
        {FLAG_VARIANT ragged}
        [ai]
            {NO_SCOUTS}
            recruitment_pattern=archer,archer,scout,fighter

            [goal]
                name=target_location 
                [criteria]
                    x,y=24,16 
                [/criteria]
                value={ON_DIFFICULTY "1.25" 2 3}
            [/goal]
        [/ai]
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Goblin Pillager" {ON_DIFFICULTY 1 2 2}}

    [side]
        side=4
        controller=ai
        gold=155
        income=10
        fog=no
        shroud=no
        share_vision=all
        type=Master Bowman
        id=Sir_Gwido
        name= _ "Sir Gwido"
        [modifications]
            [object]
                [effect]
                    apply_to=attack 
                    range=ranged 
                    [set_specials]
                        mode=append 
                            {WEAPON_SPECIAL_GIANTS_KILLER}
                    [/set_specials]
                [/effect]
            [/object]
        [/modifications]
        recruit=Bowman,Spearman,Longbowman,Javelineer,Peasant,Woodsman
        color=purple
        team_name=rebels
        user_team_name= _ "Rebel Forces"

        {FLAG_VARIANT long}

        [ai]
            recruitment_pattern=archer,archer,archer,fighter,mixed fighter
            [avoid]
                [not]
                    x,y,radius=21,16,5
                [/not]
            [/avoid]

            [goal]
                name=protect_location
                [criteria]
                    x,y,radius=24,16,4
                [/criteria]
                value=100
            [/goal]
        [/ai]
    [/side]

    {SILENTLY_LIMIT_LEADER_MOVES 4 1}

    [side]
        side=5
        controller=ai
        fog=no
        shroud=no
        share_vision=all
        no_leader=yes
        color=black
        team_name=elves,evil_orcs,bazur,rebels
        hidden=yes
        user_team_name= _ "Neutrals"
        {FLAG_VARIANT ragged}
        [ai]
            allow_ally_villages=yes
            [goal]
                name=target_unit 
                [criteria]
                    side=1 
                [/criteria]
                value=10 
            [/goal]
            [avoid]
                x=31
                y=28
                radius=6
            [/avoid]
            [avoid]
                x=4
                y=17
                radius=6
            [/avoid]
        [/ai]
    [/side]

    {PEASANT_SIDE 6}

    [side]
        side=7
        controller=ai
        fog=no
        shroud=no
        share_vision=all
        color=orange
        team_name=elves
        hidden=yes
        user_team_name= _ "Elvish Forces"
        {FLAG_VARIANT wood-elvish}
        [ai]
            aggression=1
            village_value=0 
            scout_village_targeting=0 
            [goal]
                name=taget_unit 
                [criteria]
                    id=Bazur 
                [/criteria]
                value=100 
            [/goal]
            [goal]
                name=taget_unit 
                [criteria]
                    id=Isolde
                [/criteria]
                value=100 
            [/goal]
        [/ai]
    [/side]
    [+side]
        [ai]
            [avoid]
                x=31
                y=28
                radius=6
            [/avoid]
            [avoid]
                x=4
                y=17
                radius=6
            [/avoid]
        [/ai]
    [/side]

    {AD_CAPTURE_EVENT 6}
    
    {AD_LOYALS_EVENTS}

    {AD_MARAUDERS}
    {HERODEATH_ACT_I}

    [event]
    name=prestart

        [recall]
            id=Aryn
            placement=leader
        [/recall]

        {NAMED_UNIT 6 Peasant 32 13 () (Cowardly Peasant) (role=coward
        [modifications]
            {TRAIT_SCARED}
        [/modifications])}
        {NAMED_UNIT 6 Peasant 32 11 () (Cowardly Peasant) (role=coward
        [modifications]
            {TRAIT_SCARED}
        [/modifications])}
        {NAMED_UNIT 6 Peasant 24 10 () (Cowardly Peasant) (role=coward
        [modifications]
            {TRAIT_SCARED}
        [/modifications])}
        {NAMED_UNIT 6 Peasant 27 12 () (Cowardly Peasant) (role=coward
        [modifications]
            {TRAIT_SCARED}
        [/modifications])}
        {NAMED_UNIT 6 Peasant 23 9 () (Cowardly Peasant) (role=coward
        [modifications]
            {TRAIT_SCARED}
        [/modifications])}
        {NAMED_UNIT 6 Peasant 17 10 () (Cowardly Peasant) (role=coward
        [modifications]
            {TRAIT_SCARED}
        [/modifications])}

        {GENERIC_UNIT 4 Bowman 16 18}{GUARDIAN}
        {GENERIC_UNIT 4 Longbowman 19 20}{GUARDIAN}
        {GENERIC_UNIT 4 Bowman 21 21}{GUARDIAN}
        {GENERIC_UNIT 4 Javelineer 24 19}{GUARDIAN}
        {GENERIC_UNIT 4 Spearman 16 15}{GUARDIAN}
        {GENERIC_UNIT 4 Bowman 26 18}{GUARDIAN}
        {GENERIC_UNIT 4 Spearman 26 14}{GUARDIAN}
        {GENERIC_UNIT 4 Bowman 24 12}{GUARDIAN}
        {GENERIC_UNIT 4 Longbowman 21 11}{GUARDIAN}
        {GENERIC_UNIT 4 Bowman 18 12}{GUARDIAN}
        {GENERIC_UNIT 4 Longbowman 16 13}{GUARDIAN}

        [micro_ai]
            side=4
            ai_type=zone_guardian
            action=add
    
            [filter]
                side=4
                canrecruit=no
            [/filter]

            [filter_location]
                x,y,radius=21,16,5
            [/filter_location]

        [/micro_ai]

        [micro_ai]
            side=2
            ai_type=simple_attack
            action=add

            [filter]
                id=Big_Kruuk
            [/filter]
            [filter_second]
                level=0
            [/filter_second]
        [/micro_ai]

        [micro_ai]
            side=4
            ai_type=simple_attack
            action=add

            [filter]
                id=Sir_Gwido
            [/filter]
            [filter_second]
                level=3
                [not]
                    side=1
                [/not]
            [/filter_second]
        [/micro_ai]

        [micro_ai]
            side=5
            ai_type=simple_attack
            action=add

            [filter]
                side=5
            [/filter]
            [filter_second]
                side=1
            [/filter_second]
        [/micro_ai]

        [micro_ai]
            side=6
            ai_type=goto
            action=add

            [filter]
                role=coward
            [/filter]
            [filter_location]
                x,y=38,1
                radius=1
            [/filter_location]
            ca_score=600000
        [/micro_ai]

        {NAMED_UNIT 6 Peasant 26 22 () (Brave Peasant) (role=brave)}
        {NAMED_UNIT 6 Peasant 28 21 () (Brave Peasant) (role=brave)}
        {NAMED_UNIT 6 Peasant 23 24 () (Brave Peasant) (role=brave)}
        {NAMED_UNIT 6 Peasant 27 21 () (Brave Peasant) (role=brave)}
        {NAMED_UNIT 6 Peasant 32 19 () (Brave Peasant) (role=brave)}

        {NAMED_UNIT 6 Peasant 12 17 () (Brave Peasant) (role=brave)}
        {NAMED_UNIT 6 Peasant 11 14 () (Brave Peasant) (role=brave)}
        {NAMED_UNIT 6 Peasant 7 14 () (Brave Peasant) (role=brave)}
        {NAMED_UNIT 6 Peasant 26 21 () (Brave Peasant) (role=brave)}

        {NAMED_UNIT 2 (Troll Warrior) 27 22 (Big_Kruuk) (Big Kruuk) (
        {TRAIT_STRONG}
        {TRAIT_FEARLESS})}

        {GENERIC_UNIT 2 Troll 19 24}
        {GENERIC_UNIT 2 "Troll Rocklobber" 30 20}

        {GENERIC_UNIT 3 (Orcish Grunt) 8 18}
        {GENERIC_UNIT 3 (Orcish Archer) 5 15}
        {GENERIC_UNIT 3 (Orcish Crossbowman) 15 23}

        [unit_overlay]
            role=coward
            image="misc/fear.png"
            object_id=fear
        [/unit_overlay]

        {FORCE_CHANCE_TO_HIT id=Big_Kruuk level=0 100 ()}
        {FORCE_CHANCE_TO_HIT id=Sir_Gwido level=3 90 ()}
    [/event]

    [event]
    name=start 

        [message]
            speaker=Isolde
            message= _ "Looks like the orcs have only begun their siege! We’re just in time!"
        [/message] 

        [message]
            speaker=Bazur
            message= _ "Bah, what great allies we have here - troll-head and fox-tail!"
        [/message] 

        [message]
            speaker=Isolde
            message= _ "What are you talking about?"
        [/message] 

        [scroll_to_unit]
            id=Warlord_South 
        [/scroll_to_unit]

        [message]
            speaker=Bazur
            scroll=no
            message= _ "See the orcs under the blue banner? Those are the Stoneskins, or troll-heads. They are so friendly with trolls they became just like them - lazy and meek! The trolls do all the work and the chiefs have little control over them."
        [/message] 

        [message]
            scroll=no
            speaker=Isolde
            message= _ "Got it. And what’s a fox-tail?"
        [/message] 

        [scroll_to_unit]
            id=Warlord_West 
        [/scroll_to_unit]

        [message]
            speaker=Bazur
            scroll=no
            message= _ "The fox-tails are the other orcs, under the green banner. They like fire, that’s why they’re called fox-tails, which in our tongue means ‘fire’. They burn everything but they don’t know how to fight. They are as useless as troll-heads, so they are not respected."
        [/message] 

        [message]
            speaker=Isolde
            message= _ "I see. And you’re from a respected clan, I take it?"
        [/message] 

        [message]
            speaker=Bazur
            message= _ "Of course! I am Bazur White Fang, my clan is the oldest, every orc knows it. You should be proud that I fight for you!"
        [/message] 

        [message]
            speaker=Isolde
            message= _ "I’ll be proud when we take Tath. Go ahead, prove you’re better than them!"
        [/message]

        [message]
            speaker=Bazur
            message= _ "Watch me!"
        [/message] 

        [message]
            speaker=Sir_Gwido 
            message= _ "We’re surrounded, but don’t despair, friends! I’ve sent Lars to Glyn’s Forest, he’ll be back soon with reinforcements!"
        [/message]

        [scroll_to_unit]
            id=Bazur 
        [/scroll_to_unit]

        [objectives]
            silent=no
                [objective]
                    [show_if]
                        [have_unit]
                            id=Sir_Gwido
                        [/have_unit]
                    [/show_if]
                    caption= _ "Your first task:"
                    description= _ "Defeat Sir Gwido"
                    condition=win
                [/objective]
                [objective]
                    [show_if]
                        [have_unit]
                            id=Sir_Gwido
                        [/have_unit]
                    [/show_if]
                    description= _ "Your allies are unreliable, be on your guard!"
                    condition=win
                [/objective]
                [objective]
                    [show_if]
                        [variable]
                            name=leaderkill
                            numerical_equals=1
                        [/variable]
                    [/show_if]
                    caption= _ "New task:"
                    description= _ "Kill all enemies within a 5 hex radius of Tath’s citadel"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Bazur"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Deth of Isolde"
                    condition=lose
                [/objective]
                {TURNS_RUN_OUT}
                [gold_carryover]
                    bonus=yes
                    carryover_percentage=40
                    carryover_add=yes
                [/gold_carryover]
        [/objectives]   
    [/event]

    [event]
        name=last breath 

        [filter]
            id=Sir_Gwido 
        [/filter]

        [message]
            speaker=Sir_Gwido 
            message= _ "Apparently, I’m destined to fall in this fight... Lady Aviel, I dedicate my last wish to you - may you be safe!"
        [/message]
        [message]
            speaker=Isolde
            message= _ "Without a leader, the rebels are trembling, soon they will surrender!"
        [/message]
        [event]
        name=new turn 

            [fire_event]
                name=rebellion 
            [/fire_event]
        [/event]
    [/event]

    [event]
    name=rebellion

        {VARIABLE leaderkill 1}
        {INCIDENTAL_MUSIC northerners.ogg}

        [message]
            side=4
            canrecruit=no
            message= _ "We surrender!"
        [/message]

        [message]
            speaker=Isolde
            message= _ "Commonfolk of Tath, lay down your weapons and go home."
        [/message] 

        [kill]
            side=4 
            animate=no 
        [/kill]

        [message]
            speaker=Isolde
            message= _ "The city is ours. Orcs, halt the slaughter!"
        [/message] 

        [store_unit]
            [filter]
                side=2
                race=troll 
            [/filter]
            variable=troll 
            kill=no 
        [/store_unit]

        [message]
            find_in=troll
            message= _ "$troll.name not want to halt, he keep squashing crawlers!"
        [/message] 

        {CLEAR_VARIABLE troll}

        [message]
            speaker=Warlord_South
            message= _ "We have orders to deal with the rebels and we’re just getting started, why stop?"
        [/message] 

        [message]
            speaker=Isolde
            message= _ "We all have the same order - to bring Tath back under the banner of the Crown, not to destroy it."
        [/message] 

        [message]
            speaker=Warlord_West
            message= _ "You are not my commander! You will not deprive my warriors of the spoils of war!"
        [/message] 

        [message]
            speaker=Bazur 
            message= _ "What’s wrong with punishing and plundering the rebels?"
        [/message]

        [message]
            speaker=Isolde
            message= _ "And you too?! If you disobey orders, the queen will deprive you of all your rewards!"
        [/message] 

        [message]
            speaker=Warlord_West
            message= _ "‘Oh, the queen, our mighty queen!’ Hahaha! Your queen can’t do anything without orcs! Why do you listen to that human, Whitefang? Kill her and join the fun!"
        [/message] 

        [message]
            speaker=Isolde
            message= _ "You make a move, Bazur, and an arrow in your throat will be your final reward."
        [/message] 

        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Isolde loads her crossbow."
        [/message] 

        [message]
            speaker=Bazur 
            message= _ "..."
        [/message]

        [message]
            speaker=Bazur 
            message= _ "She’s got a point. It’s better to obey the queen, she’ll pay more that way!"
        [/message]

        [if]
            [have_unit]
                side=2,3,6,7
                [filter_location]
                    x,y=21,16
                    radius=5
                [/filter_location]
            [/have_unit]
        [then]
            [message]
                speaker=Warlord_West
                message= _ "What a shame, the Whitefang chief is scared of a she-human! I’m not like him, I’ll take what’s mine and no one will stop me!"
            [/message]

            [message]
                speaker=Warlord_South
                message= _ "As will I!"
            [/message] 

            [message]
                speaker=Isolde
                message= _ "It’s a good thing you’re wiser than those two. General Dommel will be here soon, and if we don’t drive these marauders out of the town, he’ll punish us along with them!"
            [/message] 

            [message]
                speaker=Bazur 
                message= _ "Then attack!"
            [/message]

            [modify_side]
                side=4
                team_name=bazur
                user_team_name= _ "Loyalists"
                color=purple
                {FLAG_VARIANT loyalist}
            [/modify_side]
            
            [modify_side]
                side=2,3
                team_name=evil_orcs
                user_team_name= _ "Marauders"
            [/modify_side]

            [modify_turns]
                add={ON_DIFFICULTY 20 18 16}
            [/modify_turns]

            [show_objectives][/show_objectives]

            [event]
                name=die,moveto
                first_time_only=no 

                [filter]
                    side=2,3,6,7
                [/filter]

                [if]
                    [have_unit]
                        side=2,3,6,7
                        [filter_location]
                            x,y=21,16
                            radius=5
                        [/filter_location]
                    [/have_unit]
                [then]
                [/then]
                [else]
                    [endlevel]
                        result=victory
                        {NEW_GOLD_CARRYOVER 40}
                    [/endlevel]
                [/else]
                [/if]
            [/event]
        [/then]
        [else]
            [endlevel]
                result=victory
                {NEW_GOLD_CARRYOVER 40}
            [/endlevel]
        [/else]
        [/if]
    [/event]

    [event]
    name=victory

        [modify_side]
            side=2,3
            team_name=bazur
        [/modify_side]

        [modify_side]
            side=4
            color=white
        [/modify_side]

        [message]
            side=2,3
            message= _ "Alright, no plunder, no fun, we get it! Stop!"
        [/message]

        [message]
            speaker=Isolde
            message= _ "I am glad we are finally in agreement."
        [/message] 

        [scroll_to]
            x,y=21,16 
        [/scroll_to]

        [hide_unit]
            side=1,2,3,4,5,6,7
        [/hide_unit]

        {FADE_TO_BLACK}

        [label]
            x,y=21,16
            text= _ ""
            immutable=yes
        [/label]

        [kill]
            side=2,3,4,5,6,7
            canrecruit=no 
        [/kill]

        [put_to_recall_list]
            side=1
            canrecruit=no 
            [not]
                id=Isolde 
            [/not]
        [/put_to_recall_list]

        {TELEPORT_UNIT id=Warlord_South 18 16}
        {TELEPORT_UNIT id=Warlord_West 18 14}
        {TELEPORT_UNIT id=Bazur 18 15}

        [modify_unit]
            [filter]
                race=orc 
                canrecruit=yes 
            [/filter]
            facing=se
        [/modify_unit]

        {TELEPORT_UNIT id=Isolde 20 15}

        {FULL_HEAL id=Warlord_South}
        {FULL_HEAL id=Warlord_West}
        {FULL_HEAL id=Bazur}
        {FULL_HEAL id=Isolde}

        [print]
            text= _ "Soon General Dommel arrived at Tath..."
            size=50
            duration=1000
            color=255,255,255
        [/print]

        [delay]
            time=1000
        [/delay]

        {FADE_IN}

        [label]
            x,y=21,16
            text= _ "Tath"
            immutable=yes
        [/label]

        [unhide_unit]
            side=1,2,3,4
        [/unhide_unit]

        {UNIT 4 General 21 16 (
        {DOMMEL}
        canrecruit=yes
        facing=sw)}
        {UNIT 4 Halberdier 19 17 (facing=sw)}
        {UNIT 4 Halberdier 19 15 (facing=sw)}

        {INCIDENTAL_MUSIC sad.ogg}
        {APPEND_MUSIC knolls.ogg}

        [message]
            speaker=Dommel
            message= _ "What happened here, why are the city streets drowning in blood?"
        [/message] 

        [message]
            speaker=Warlord_South
            message= _ "The Whitefang was late to the assault and, because of his cowardice, our victory cost us much blood!"
        [/message]

        [message]
            speaker=Dommel
            message= _ "Silence, orc, I’m not talking to you!"
        [/message] 

        [message]
            speaker=Isolde
            message= _ "General, we arrived just in time to take the city in a blitz, but orcs from the other squads began to loot and massacre. It was necessary for me to discipline them."
        [/message] 

        [message]
            speaker=Dommel
            message= _ "Which of these three are from your squad?"
        [/message] 

        [message]
            speaker=Isolde
            message= _ "(pointing at Bazur) He is, General."
        [/message] 

        [message]
            speaker=Dommel
            message= _ "Guards, let this one live, execute the rest."
        [/message] 

        [message]
            speaker=Warlord_South
            message= _ "Whoa, whoa, whoa, chief, stop-"
        [/message] 

        [animate_unit]
        flag=attack
            [filter]
                x,y=19,17
            [/filter]
            [facing]
                x,y=18,16
            [/facing]
            [primary_attack]                    
                range=melee
                type=blade
            [/primary_attack]
            hits=yes
            [animate]
                flag=defend
                    [filter]
                        x,y=18,16
                    [/filter]
                    hits=yes
                [/animate]
            [/animate_unit]

            [kill]
                id=Warlord_South
                animate=yes
            [/kill]

            {PLACE_IMAGE "units/orcs/grunt-die-8.png~RC(magenta>blue)~FL(horiz)" 18 16}

            [animate_unit]
            flag=attack
                [filter]
                    x,y=19,15
                [/filter]
                [facing]
                    x,y=18,14
                [/facing]
                [primary_attack]
                    range=melee
                    type=blade
                [/primary_attack]
                hits=yes
                [animate]
                    flag=defend
                    [filter]
                        x,y=18,14
                    [/filter]
                    hits=yes
                [/animate]
            [/animate_unit]

            [kill]
                id=Warlord_West
                animate=yes
            [/kill]

            {PLACE_IMAGE "units/orcs/grunt-die-8.png~RC(magenta>green)" 18 14}

            [delay]
                time=400
            [/delay]

            [message]
                speaker=Dommel
                message= _ "Mark my words, orc! You have been recruited into the <i>Royal Army</i>. What separates the <i>Royal Army</i> from the orcish horde is <i>iron discipline</i>. <i>Discipline</i> means obeying orders <i>exactly</i> as commanded. You kill only those you’re ordered to kill. If you disobey orders, you’ll share the fate of these marauders. Do I make myself clear?"
            [/message] 

            [message]
                speaker=Bazur
                message= _ "I got it, chief!"
            [/message] 

            [message]
                speaker=Dommel
                message= _ "Chiefs in your wastelands and generals in Wesnoth. Remember it."
            [/message] 

            [message]
                speaker=Dommel
                message= _ "I got your dispatch, Isolde. Tell me of the happenings in Glyn’s Forest."
            [/message]

            [message]
                speaker=narrator
                image=wesnoth-icon.png 
                message= _ "Isolde reported her raid to the general."
            [/message] 

            [message]
                speaker=Dommel
                message= _ "So the witch did ruin Gwido after all. That’s unfortunate. Did you kill her?"
            [/message]

            [message]
                speaker=Isolde
                message= _ "No, general, we only defeated the rebels."
            [/message] 

            [message]
                speaker=Dommel
                message= _ "And rightly so. All the elvish lords have their eyes on our war right now. We cannot give them a reason to interfere. Although I don’t think elves belong in a forest named after the Founding King’s son."
            [/message]

            [message]
                speaker=Isolde
                message= _ "I agree. How is the war going, general? Any news from the south?"
            [/message]

            [message]
                speaker=Dommel
                message= _ "The queen defeated de Ferres at Weldyn and has moved on to Dan’Tonk. I have orders to lay siege to the city from the north. I also have special orders for orcs loyal to the crown, if there are any such things."
            [/message] 

            [message]
                speaker=Bazur
                message= _ "I’m loyal to the crown, loyal as can be!"
            [/message] 

            [message]
                speaker=Isolde
                message= _ "I think my orcs will do just fine. What are the orders?"
            [/message]

            [message]
                speaker=Dommel
                message= _ "Dan’Tonk is a great fortress. Even after all his defeats, de Ferres has hundreds of soldiers at hand. A straight assault would cost us dearly. However, there is a secret tunnel between Tath and Dan’Tonk that leads to the catacombs, and from there to the heart of the city. The queen wants the orcs to sneak through the tunnel and open the gates of Dan’Tonk from the inside just before the assault."
            [/message] 

            [message]
                speaker=Bazur
                message= _ "I can do it! Tunnels are no problem for me and I can knock down gates in a heartbeat!"
            [/message]

            [message]
                speaker=Isolde
                message= _ "I accept this mission, general."
            [/message] 

            [message]
                speaker=Dommel
                message= _ "You mustn’t go with the orcs, Isolde. Stay in my army, I’ll give you a squad of swordsmen instead of these brutes."
            [/message]

            [message]
                speaker=Isolde
                message= _ "The queen said these orcs would be my soldiers. A commander should not abandon her soldiers, should she, general?"
            [/message] 

            [message]
                speaker=Dommel
                message= _ "You sound just like your husband. That’s why I don’t wish to send you. There’s little chance of survival in the middle of a siege and Wesnoth needs people like you."
            [/message]

            [message]
                speaker=Isolde
                message= _ "I would disgrace my husband’s honor if I abandoned my soldiers."
            [/message] 

            [message]
                speaker=Dommel
                message= _ "Then I won’t discourage you. Go, and may all the gods protect you, if they still care about our country."
            [/message]

            [message]
                speaker=Bazur
                message= _ "Wait, chie-, general, what about the reward?"
            [/message]

            [message]
                speaker=Dommel
                message= _ "Ah, yes. The queen sent a sword as a reward for <i>her loyal dog</i>. That would be you. Wear it proudly, your paws have never before held such a masterful weapon, nor will they ever again should it slip from their grasp!"
            [/message]

            [object]
                [filter]
                    is=Bazur 
                [/filter]

                duration=forever 
                name= _ "Wesnothian Great Sword"
                image="attacks/greatsword-human.png"
                description= _ "The honed blade from the Royal Armory replaces Bazur’s sword, and increases melee damage by 3!"

                [effect]
                    apply_to=attack 
                    range=melee 
                    increase_damage=3 
                    set_icon="attacks/greatsword-human.png"
                    set_description= _ "wesnothian greatsword"
                [/effect]
            [/object]

            [message]
                speaker=Bazur
                message= _ "So big and sharp! I’m proud, I’m so proud!"
            [/message]

            [message]
                speaker=Dommel
                message= _ "Now go. The assault will begin in two weeks, you’ll know it by the terrible rumble from the surface. As soon as the rumbling dies down some, go in. And try to survive, Isolde."
            [/message]

            [message]
                speaker=Isolde
                message= _ "Thank you, general."
            [/message] 
    [/event]  

    [event]
    name=last_breath 

        [filter]
            side=2,3
            canrecruit=yes 
        [/filter]

        [modify_unit]
            [filter]
                id=$second_unit.id
            [/filter]
            experience="$($second_unit.experience + 24)"
        [/modify_unit]

        [modify_unit]
            [filter]
                find_in=unit 
            [/filter]
            hitpoints=1
        [/modify_unit]

        [endlevel]
            result=victory 
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
    name=time over 

        [message]
            speaker=Isolde
            message= _ "We did not take Tath in time... the Queen’s plan is foiled. General Dommel will be here soon and he will be furious."
        [/message]

        [message]
            speaker=Bazur
            message= _ "Will he still pay?"
        [/message]
    [/event]

    #Cowarldy Peasants-related events:
    #Isolde won't attack them:

    [event]
        name=attack 
        first_time_only=no 

        [filter]
            id=Isolde
        [/filter]
        [filter_second]
            role=coward 
        [/filter_second]

        [message]
            speaker=Isolde 
            message= _ "I shall not harm fleeing peasants."
        [/message]

        [cancel_action][/cancel_action]

        [modify_unit]
            [filter]
                id=Isolde 
            [/filter]
            attacks_left=1 
        [/modify_unit]
    [/event]

    # But Bazur is glad to do it:

    [event]
        name=attack  
        id=orcish_attack_event

        [filter]
            side=1 
            [not]
                race=human 
            [/not]
        [/filter]
        [filter_second]
            role=coward 
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "More orcs are pouring out of the woods! Beware!"
        [/message]

        [message]
            speaker=unit
            message= _ "Fight, you human goblin!"
        [/message]
        [remove_event]
            id=human_attack_event 
        [/remove_event]
    [/event]

    [event]
        name=attack
        id=human_attack_event  

        [filter]
            side=1 
            race=human 
            [not]
                id=Isolde 
            [/not]
        [/filter]
        [filter_second]
            role=coward 
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "A-a-a, it’s not ours, royal punishers are coming out of the woods!"
        [/message]

        [message]
            speaker=unit
            message= _ "Bow to the queen, or die!"
        [/message]
        [remove_event]
            id=orcish_attack_event
        [/remove_event]
    [/event]

    [event]
        name=attack

        [filter]
            race=elf
        [/filter]
        [filter_second]
            role=coward 
        [/filter_second]

        [message]
            speaker=second_unit
            message= _ "Elves, help us!"
        [/message]

        [message]
            speaker=unit
            message= _ "You have failed the Lady and won’t fight for your freedom. You are not worthy of the elves’ help, death is the best outcome for you!"
        [/message]
    [/event]

    [event]
    name=moveto 
    first_time_only=no 

        [filter]
            role=coward
            [filter_location]
                x,y=38,1
                radius=1
            [/filter_location]
        [/filter]

        [kill]
            find_in=unit 
            animate=no 
        [/kill]
    [/event]

    #Big Kruuk smash the peasants

    [event]
    name=attack 
    first_time_only=yes 

        [filter]
            id=Big_Kruuk
        [/filter]

        [filter_second]
            type=Peasant
        [/filter_second]

        [message]
            speaker=unit
            message= _ "Run, bug, run! Ha-ha-ha!"
        [/message] 
    [/event]

    #de Ferre's reinforcements 
    [event]
        name=turn 9

        [scroll_to]
            x,y=7,31
        [/scroll_to]

        [sound]
            name=horse-canter.wav 
        [/sound]

        [move_unit_fake]
            type=Сavalier
            side=6
            x=7,8,9,9,10,10,11
            y=31,30,30,29,28,27,27
        [/move_unit_fake]

        {GENERIC_UNIT 6 Cavalier 11 27}

        [move_unit_fake]
            type=Cavalier
            side=6
            x=7,8,9,9,10,10,11
            y=31,30,30,29,28,27,28
        [/move_unit_fake]

        {GENERIC_UNIT 6 Cavalier 11 28}

        [move_unit_fake]
            type=Cavalier
            side=6
            x=7,8,9,9,10,10,10
            y=31,30,30,29,28,27,26
        [/move_unit_fake]

        {GENERIC_UNIT 6 Cavalier 10 26}

        [move_unit_fake]
            type=Cavalier
            side=6
            x=7,8,9,9,10,10
            y=31,30,30,29,28,27
        [/move_unit_fake]

        {GENERIC_UNIT 6 Cavalier 10 27}

        [if]
            [have_unit]
                id=Sir_Gwido 
            [/have_unit]
        [then]

        [message]
            side=6
            type=Cavalier 
            message= _ "Baron de Ferres sent us to aid Tath."
        [/message]

        [message]
            speaker=Sir_Gwido
            message= _ "Good to see you riders! We’re in a tough spot, see if you can’t break through this orc encirclement!"
        [/message]

        [message]
            side=6
            type=Cavalier 
            message= _ "We’ll cut our way through."
        [/message]
        [/then]

        [else]
            [message]
                side=6
                type=Cavalier 
                message= _ "The city has fallen, but cavaliers never flee the battlefield! If this is to be our end then let it be one these beasts will not soon forget!"
            [/message]
        [/else]
    [/if]
    [/event]

    [event]
        name=attack 

        [filter]
            id=Aryn 
        [/filter]

        [filter_second]
            type=Cavalier 
        [/filter_second]

        [message]
            speaker=second_unit
            image_pos=right # because he'll often have the same portrait as Aryn
            message= _ "A regret to see a worthy cavalryman in the enemy’s ranks! A stroke of the sword will eliminate this sight!"
        [/message]

        [message]
            speaker=Aryn
            message= _ "I can say the same thing! Defend yourself, sir!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            type=Cavalier
        [/filter]
        [filter_second]
            id=Aryn
        [/filter_second]

        [message]
            speaker=Aryn
            message= _ "Farewell, sir, may the songs of your valor never fade!"
        [/message]
        [message]
            speaker=unit
            image_pos=right # because he'll often have the same portrait as Aryn
            message= _ "Better to die at the hand of a fellow knight than any of these foul orcs! Take my crossbow, $second_unit.type, and fight on in my memory."
        [/message]

        {ADVANCE_UNIT id=Aryn ""}

        [object]
            name= _"Cavalier’s Crossbow"
            image="attacks/crossbow-human.png"
            description= _ "With a second crossbow at his hip, Aryn’s ranged attack is now twice as powerful!"
            duration=forever
            [filter]
                id=Aryn
            [/filter]
            [effect]
                apply_to=attack
                range=ranged
                increase_attacks=1
            [/effect]
        [/object]
    [/event]

    [event]
    name=turn 3 

        {SPAWN_UNIT 5 "Direwolf Rider" 4 1 7 3}
        [+unit]
            id=Punk 
            name= _ "Punk"
            {IS_HERO}
            facing=se
        [/unit]

        {SPAWN_UNIT 5 "Goblin Knight" 4 1 7 4}
        {SPAWN_UNIT 5 "Goblin Knight" 4 1 8 2}
        {SPAWN_UNIT 5 "Goblin Pillager" 4 1 6 3}
        {SPAWN_UNIT 5 "Goblin Pillager" 4 1 7 2}

        [message]
            speaker=Bazur
            message= _ "Hey, goblins, why are you coming here?"
        [/message]

        [message]
            speaker=Punk
            message= _ "We heard a she-human is desperate for hirelings, and she pays well! Some horseriders told us to go to Soradoc and she’d hire us. But where is Soradoc? We went to some town and were met with arrows! Punk thinks horseriders told lies."
        [/message]

        [message]
            speaker=Bazur
            message= _ "You’re wrong, ’tis all true. I myself am a hireling for their Queen Majesty!"
        [/message]

        [message]
            speaker=Punk
            message= _ "Is the coin good?"
        [/message]

        [message]
            speaker=Bazur
                [option]
                    message= _ "Good enough to make me the next High Chief! Join me and you’ll get some too!"
                    [command]
                        [message]
                            speaker=Punk
                            message= _ "Punk’s no fool, he won’t fight for nothing. Give 100 gold coins and Punk is yours!"
                        [/message]

                        [store_gold]
                            variable=bazurgold
                            side=1
                        [/store_gold]

                        [message]
                            speaker=Bazur
                            [option]
                                [show_if]
                                    {VARIABLE_CONDITIONAL bazurgold greater_than_equal_to 100}
                                [/show_if]
                                message= _ "Alright, here’s your gold, now get to work! (-100 gold)"
                                [command]
                                    [sound]
                                        name=gold.ogg
                                    [/sound]
                                    [gold]
                                        amount=-100
                                        side=1
                                    [/gold]
                                    {MODIFY_UNIT side=5 side 1}
                                    [message]
                                        speaker=Punk 
                                        message= _ "Punk will tear your foes apart!"
                                    [/message]
                                [/command]
                            [/option]
                            [option]
                                [show_if]
                                    {VARIABLE_CONDITIONAL bazurgold less_than 100}
                                [/show_if]
                                message= _ "I don’t have 100 gold right now."
                                [command]
                                    [message]
                                        speaker=Punk 
                                        message= _ "So there really is nothing to catch in this war, Punk is leaving!"
                                    [/message]
                                    [kill]
                                        side=5
                                        animate=no 
                                    [/kill]
                                [/command]
                            [/option]
                            [option]
                                message= _ "Greedy goblin! Either you fight for me or you go in my stewpot!"
                                [command]
                                    [message]
                                        speaker=Punk 
                                        message= _ "Why do you have to yell? Alright, alright, Punk will obey!"
                                    [/message]
                                    {MODIFY_UNIT side=5 side 1}
                                [/command]
                            [/option]
                        [/message]   
                    [/command]
                [/option]
                [option]
                    message= _ "Sure is! But you won’t see any of it, you runt! Begone, I’ll have no competitors!"
                    [command]
                        [message]
                            speaker=Punk 
                            message= _ "Punk will take the gold off your corpse!"
                        [/message]

                        [modify_side]
                            side=5
                            team_name=evil_orcs
                        [/modify_side]
                    [/command]
                [/option]
        [/message]
    [/event]

    [event]
    name=die 

        [filter]
            id=Punk 
            side=5
        [/filter]

        [message]
            speaker=Bazur
            message= _ "Hey, that runt’s dropped a vial of the special poison they use on their wolves’ claws! Somebody’s got to pick it up!"
        [/message]

        {HIGHLIGHT_IMAGE $unit.x $unit.y items/potion-poison.png ()}
        {VARIABLE poisonX $x1}
        {VARIABLE poisonY $y1}

        [event]
            name=moveto
            id=take_item
            first_time_only=no 
            [filter]
                side=1
                [filter_location]
                    x,y=$poisonX,$poisonY
                [/filter_location]
            [/filter]
            [message]
                speaker=unit
                message= _ "I can put poison on my melee weapons, and get the <i>poison</i> special for them."
                [option]
                    label= _ "I’ll take it."
                    [command]
                        {REMOVE_IMAGE $poisonX $poisonY}
                        [remove_event]
                            id=take_item
                        [/remove_event]

                        {CLEAR_VARIABLE poisonX}
                        {CLEAR_VARIABLE poisonY}

                        [object]
                            name= _ "Goblin’s Special Poison"
                            image=icons/potion_green_small.png
                            description= _ "Brewed by goblin alchemists from the most toxic of materials, the poison will be a good asset to any fighter who does not hesitate to use such an insidious tool."
                            [effect]
                                apply_to=attack 
                                range=melee
                                [set_specials]
                                    mode=append
                                    {WEAPON_SPECIAL_POISON}
                                [/set_specials]
                            [/effect]
                            [effect]
                                apply_to=overlay 
                                add="misc/item-overlay.png"
                            [/effect]
                        [/object]
                        {FIRST_ITEM_EVENT}
                    [/command]
                [/option]
                [option]
                    label= _ "I’ll leave this for someone else."
                    [command]
                        [allow_undo] 
                        [/allow_undo]
                    [/command]
                [/option]
            [/message]
        [/event]
        [event]
        name=victory 
            {CLEAR_VARIABLE poisonX}
            {CLEAR_VARIABLE poisonY}
        [/event]
    [/event]
[/scenario]
